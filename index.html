<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <title>WorkFlow Calendar ‚Äì detailn√° verzia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --primary: #2563eb;
      --primary-soft: #e5edff;
      --text-main: #111827;
      --text-sub: #6b7280;
      --danger: #dc2626;
      --success: #16a34a;
      --radius-card: 16px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.12);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }
    .app-header {
      position: sticky;
      top: 0;
      z-index: 20;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(18px);
      box-shadow: 0 1px 6px rgba(15,23,42,0.12);
    }
    .app-header h1 {
      margin: 0;
      font-size: 17px;
      font-weight: 600;
    }
    .nav-tabs {
      display: flex;
      gap: 6px;
      overflow-x: auto;
      max-width: 60%;
    }
    .nav-tabs button {
      border: none;
      background: var(--primary-soft);
      color: var(--primary);
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 11px;
      cursor: pointer;
      white-space: nowrap;
    }
    .nav-tabs button.active {
      background: var(--primary);
      color: #fff;
    }
    main {
      padding: 14px;
      max-width: 1100px;
      margin: 0 auto 70px auto;
    }
    .section {
      display: none;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(18px);
      border-radius: var(--radius-card);
      padding: 14px 16px;
      margin-bottom: 14px;
      box-shadow: var(--shadow-soft);
    }
    .section.active { display: block; }
    .section h2 {
      margin: 0 0 4px 0;
      font-size: 15px;
      font-weight: 600;
    }
    .sub {
      margin: 0 0 10px 0;
      font-size: 12px;
      color: var(--text-sub);
    }
    .row { display: flex; flex-wrap: wrap; gap: 10px; }
    .col { flex: 1 1 260px; }
    .card-list { display: flex; flex-direction: column; gap: 8px; font-size: 13px; }
    .item {
      padding: 8px 10px;
      border-radius: 12px;
      background: rgba(249,250,251,0.9);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.08s ease;
    }
    .item:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(15,23,42,0.12);
      background: #ffffff;
    }
    .item-main { display: flex; flex-direction: column; gap: 2px; }
    .item-title { font-weight: 600; font-size: 13px; }
    .item-sub { font-size: 11px; color: var(--text-sub); }
    .pill {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--primary-soft);
      color: var(--primary);
      white-space: nowrap;
    }
    .pill-ok { background: #16a34a; color: #fff; }
    .pill-warn { background: #f97316; color: #fff; }
    .pill-danger { background: #dc2626; color: #fff; }
    .btn-primary, .btn-secondary, .btn-close {
      border: none;
      border-radius: 999px;
      padding: 7px 12px;
      font-size: 12px;
      cursor: pointer;
      white-space: nowrap;
    }
    .btn-primary {
      background: var(--primary);
      color: #fff;
    }
    .btn-secondary {
      background: var(--primary-soft);
      color: var(--primary);
    }
    .btn-close {
      background: transparent;
      color: var(--text-sub);
      padding: 4px 8px;
      font-size: 11px;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      font-size: 11px;
    }
    .day {
      background: #f3f4ff;
      border-radius: 10px;
      padding: 5px;
      min-height: 54px;
      position: relative;
    }
    .day span.date { font-weight: 600; font-size: 11px; }
    .dot-row { margin-top: 4px; display: flex; gap: 3px; flex-wrap: wrap; }
    .dot { width: 7px; height: 7px; border-radius: 999px; }
    .dot-shift { background: #3b82f6; }
    .dot-law { background: #f59e0b; }
    .dot-trip { background: #ec4899; }
    .dot-doc { background: #10b981; }
    .dot-pay { background: #8b5cf6; }
    .status-done {
      border-left: 3px solid var(--success);
      opacity: 0.85;
    }
    .status-done .item-title::before {
      content: "‚úì ";
      color: var(--success);
    }
    .app-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(14px);
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-around;
      padding: 5px 0;
      font-size: 11px;
      z-index: 15;
    }
    .app-footer button {
      border: none;
      background: transparent;
      cursor: pointer;
      color: var(--text-sub);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }
    .app-footer button span.icon { font-size: 14px; }
    .app-footer button.active { color: var(--primary); font-weight: 600; }
    .modal {
      position: fixed;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(16px);
      background: rgba(15,23,42,0.35);
      z-index: 30;
    }
    .modal.hidden { display: none; }
    .modal-content {
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(24px);
      border-radius: 18px;
      padding: 18px 18px 14px 18px;
      width: 92%;
      max-width: 420px;
      box-shadow: 0 18px 45px rgba(15,23,42,0.35);
      border: 1px solid rgba(255,255,255,0.8);
    }
    .modal-content h3 {
      margin: 0 0 6px 0;
      font-size: 15px;
      font-weight: 600;
    }
    .modal-content p {
      margin: 0 0 10px 0;
      font-size: 12px;
      color: var(--text-sub);
    }
    .modal-actions {
      display: flex;
      gap: 6px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .modal-content form {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }
    .modal-content input,
    .modal-content select {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 7px 10px;
      font-size: 12px;
      outline: none;
      background: rgba(255,255,255,0.9);
    }
    .modal-content input:focus,
    .modal-content select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(37,99,235,0.25);
    }
    @media (max-width: 700px) {
      .app-header h1 { font-size: 15px; }
      .nav-tabs { max-width: 58%; }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <h1>WorkFlow Calendar</h1>
    <nav class="nav-tabs">
      <button class="tab-btn active" data-target="dashboard">Dashboard</button>
      <button class="tab-btn" data-target="calendar">Kalend√°r</button>
      <button class="tab-btn" data-target="duties">Povinnosti</button>
      <button class="tab-btn" data-target="payments">Platby</button>
      <button class="tab-btn" data-target="documents">Doklady</button>
      <button class="tab-btn" data-target="trips">Cesty</button>
      <button class="tab-btn" data-target="regional">Region√°lne</button>
    </nav>
  </header>

  <main>
    <!-- DASHBOARD -->
    <section id="dashboard" class="section active">
      <h2>Prehƒæad d≈àa</h2>
      <p class="sub">Dne≈°n√° zmena, najbli≈æ≈°ie povinnosti, platby a cesty</p>
      <div class="row">
        <div class="col">
          <h3 style="font-size:13px;margin:0 0 6px 0;">Dnes</h3>
          <div class="card-list" id="dashboard-today"></div>
        </div>
        <div class="col">
          <h3 style="font-size:13px;margin:0 0 6px 0;">Najbli≈æ≈°ie povinnosti</h3>
          <div class="card-list" id="dashboard-duties"></div>
        </div>
        <div class="col">
          <h3 style="font-size:13px;margin:0 0 6px 0;">Najbli≈æ≈°ie platby</h3>
          <div class="card-list" id="dashboard-payments"></div>
        </div>
      </div>
      <br />
      <h3 style="font-size:13px;margin:0 0 6px 0;">Najbli≈æ≈°ia cesta</h3>
      <div class="card-list" id="dashboard-trip"></div>
    </section>

    <!-- KALEND√ÅR -->
    <section id="calendar" class="section">
      <h2>Kalend√°r</h2>
      <p class="sub">Zmeny, povinnosti, platby, doklady a cesty v jednom prehƒæade</p>
      <div class="calendar-grid" id="calendar-grid"></div>
      <br />
      <button class="btn-primary" onclick="openAddModal('event')">+ Prida≈• udalos≈•</button>
    </section>

    <!-- POVINNOSTI -->
    <section id="duties" class="section">
      <h2>Povinnosti</h2>
      <p class="sub">Da≈àov√© term√≠ny, odvody, kontroly a servisn√© intervaly</p>
      <div class="row">
        <div class="col">
          <h3 style="font-size:13px;margin:0 0 6px 0;">√öradn√© term√≠ny</h3>
          <div class="card-list" id="duties-law"></div>
        </div>
        <div class="col">
          <h3 style="font-size:13px;margin:0 0 6px 0;">Kontroly a prehliadky</h3>
          <div class="card-list" id="duties-checks"></div>
        </div>
        <div class="col">
          <h3 style="font-size:13px;margin:0 0 6px 0;">Servisn√© intervaly</h3>
          <div class="card-list" id="duties-service"></div>
        </div>
      </div>
      <br />
      <button class="btn-primary" onclick="openAddModal('duty')">+ Prida≈• povinnos≈•</button>
    </section>

    <!-- PLATBY -->
    <section id="payments" class="section">
      <h2>Platby</h2>
      <p class="sub">Leasingy, √∫very, spr√°va bytu, energie a in√© z√°v√§zky</p>
      <div class="card-list" id="payments-list"></div>
      <br />
      <button class="btn-primary" onclick="openAddModal('payment')">+ Prida≈• platbu</button>
    </section>

    <!-- DOKLADY -->
    <section id="documents" class="section">
      <h2>Osobn√© doklady</h2>
      <p class="sub">Sledovanie platnosti dokladov a pripomienky</p>
      <div class="card-list" id="documents-list"></div>
      <br />
      <button class="btn-primary" onclick="openAddModal('document')">+ Prida≈• doklad</button>
    </section>

    <!-- CESTY -->
    <section id="trips" class="section">
      <h2>Cesty a slu≈æobn√© v√Ωjazdy</h2>
      <p class="sub">Udalosti s adresou a navig√°ciou cez Mapy.cz</p>
      <div class="card-list" id="trips-list"></div>
      <br />
      <button class="btn-primary" onclick="openAddModal('trip')">+ Prida≈• cestu</button>
    </section>

    <!-- REGION√ÅLNE KONTAKTY -->
    <section id="regional" class="section">
      <h2>Region√°lne kontakty</h2>
      <p class="sub">√örady, pohotovosti, lek√°ri a lek√°rne podƒæa regi√≥nu</p>
      <div class="row">
        <div class="col">
          <h3 style="font-size:13px;margin:0 0 6px 0;">√örady</h3>
          <div class="card-list" id="regional-offices"></div>
        </div>
        <div class="col">
          <h3 style="font-size:13px;margin:0 0 6px 0;">Zdravotn√≠cke slu≈æby</h3>
          <div class="card-list" id="regional-health"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <button class="tab-btn-foot active" data-target="dashboard">
      <span class="icon">üè†</span><span>Dashboard</span>
    </button>
    <button class="tab-btn-foot" data-target="calendar">
      <span class="icon">üìÖ</span><span>Kalend√°r</span>
    </button>
    <button class="tab-btn-foot" data-target="duties">
      <span class="icon">üìå</span><span>Povinnosti</span>
    </button>
    <button class="tab-btn-foot" data-target="payments">
      <span class="icon">üí≥</span><span>Platby</span>
    </button>
    <button class="tab-btn-foot" data-target="documents">
      <span class="icon">ü™™</span><span>Doklady</span>
    </button>
    <button class="tab-btn-foot" data-target="trips">
      <span class="icon">üß≠</span><span>Cesty</span>
    </button>
  </footer>

  <!-- DETAIL MODAL -->
  <div id="detail-modal" class="modal hidden">
    <div class="modal-content">
      <h3 id="detail-title"></h3>
      <p id="detail-info"></p>
      <div class="modal-actions">
        <button class="btn-primary" id="mark-done-btn">Oznaƒçi≈• ako splnen√©</button>
        <button class="btn-secondary" id="pay-now-btn" style="display:none;">Zaplati≈• teraz</button>
        <button class="btn-secondary" id="navigate-btn" style="display:none;">Navigova≈• cez Mapy.cz</button>
        <button class="btn-secondary" id="delete-btn">Vymaza≈•</button>
        <button class="btn-close" onclick="closeDetailModal()">Zavrie≈•</button>
      </div>
    </div>
  </div>

  <!-- ADD MODAL -->
  <div id="add-modal" class="modal hidden">
    <div class="modal-content">
      <h3 id="add-title">Nov√° polo≈æka</h3>
      <form id="add-form">
        <input type="text" id="add-name" placeholder="N√°zov" required />
        <input type="date" id="add-date" required />
        <input type="text" id="add-extra" placeholder="Dopl≈àuj√∫ce info (suma, pozn√°mka...)" />
        <input type="text" id="add-address" placeholder="Adresa (pri cest√°ch / √∫radoch)" />
        <select id="add-type-specific">
          <option value="">Typ (len pri udalosti)</option>
          <option value="shift">Zmena</option>
          <option value="law">Povinnos≈•</option>
          <option value="payment">Platba</option>
          <option value="document">Doklad</option>
          <option value="trip">Cesta</option>
        </select>
        <button class="btn-primary" type="submit">Ulo≈æi≈•</button>
      </form>
      <div class="modal-actions">
        <button class="btn-close" onclick="closeAddModal()">Zavrie≈•</button>
      </div>
    </div>
  </div>

  <!-- ƒåAS≈§ 2 ZAƒå√çNA TU: vlo≈æ sem nasleduj√∫ci <script> blok -->
  <script>
    // Jednoduch√Ω model udalost√≠
    let events = [];
    let currentDetailId = null;
    let currentAddContext = null;

    // Inicializaƒçn√© d√°ta
    function seedData() {
      const today = new Date();
      const d = (offset) => {
        const dt = new Date(today);
        dt.setDate(dt.getDate() + offset);
        return dt.toISOString().slice(0,10);
      };

      events = [
        { id: 1, type: 'shift', title: 'Dne≈°n√° zmena ‚Äì rann√°', date: d(0), extra: '06:00 ‚Äì 14:00 ‚Ä¢ 8 hod√≠n', status: 'open' },
        { id: 2, type: 'document', title: 'Platnos≈• obƒçianskeho preukazu', date: d(30), extra: 'Konƒç√≠ o 30 dn√≠', status: 'open' },
        { id: 3, type: 'law', title: 'Da≈à z pr√≠jmu', date: d(20), extra: 'Term√≠n 31. 03. ‚Ä¢ pripomienky 30/14/7 dn√≠', status: 'open' },
        { id: 4, type: 'check', title: 'STK ‚Äì BA123XY', date: d(14), extra: 'O 14 dn√≠ ‚Ä¢ individu√°lny interval', status: 'open' },
        { id: 5, type: 'payment', title: 'Leasing ‚Äì 250 ‚Ç¨', date: d(3), extra: 'Splatnos≈• o 3 dni', status: 'open', payment: true },
        { id: 6, type: 'payment', title: 'Spr√°va bytu ‚Äì 120 ‚Ç¨', date: d(1), extra: 'Splatnos≈• zajtra', status: 'open', payment: true },
        { id: 7, type: 'trip', title: 'Slu≈æobn√° cesta ‚Äì Ko≈°ice', date: d(1), extra: 'Zajtra ‚Ä¢ 09:00 ‚Ä¢ Hlavn√° 1, Ko≈°ice', status: 'open', address: 'Hlavn√° 1, Ko≈°ice' },
        { id: 8, type: 'law', title: 'DPH ‚Äì mesaƒçne', date: d(6), extra: 'Term√≠n: 25. de≈à v mesiaci', status: 'open' },
        { id: 9, type: 'law', title: 'Z√°konn√© odvody', date: d(8), extra: 'Soci√°lne a zdravotn√© ‚Ä¢ 8. de≈à v mesiaci', status: 'open' },
        { id: 10, type: 'check', title: 'Lek√°rska prehliadka ‚Äì pr√°ca v noci', date: d(200), extra: 'Interval 24 mesiacov', status: 'open' },
        { id: 11, type: 'service', title: 'V√Ωmena oleja ‚Äì BA123XY', date: d(-10), extra: 'Posledn√°: 120 000 km ‚Ä¢ interval 15 000 km', status: 'open' },
        { id: 12, type: 'service', title: 'Servis kotla', date: d(-120), extra: 'Posledn√Ω: 01. 10. 2025 ‚Ä¢ interval 12 mesiacov', status: 'open' },
        { id: 13, type: 'document', title: 'Cestovn√Ω pas', date: d(150), extra: 'Platnos≈• do 01. 08. 2025', status: 'open' },
        { id: 14, type: 'document', title: 'Vodiƒçsk√Ω preukaz', date: d(365*4), extra: 'Platnos≈• do 10. 01. 2030', status: 'open' },
        { id: 15, type: 'payment', title: 'Hypot√©ka ‚Äì 480 ‚Ç¨', date: d(10), extra: 'Splatnos≈• o 10 dn√≠', status: 'open', payment: true },
        { id: 16, type: 'payment', title: 'Internet ‚Äì 25 ‚Ç¨', date: d(5), extra: 'Splatnos≈• o 5 dn√≠', status: 'open', payment: true }
      ];
    }

    // Pomocn√© funkcie
    function formatDate(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      return d.toLocaleDateString('sk-SK');
    }

    function byDateAsc(a, b) {
      return (a.date || '').localeCompare(b.date || '');
    }

    function renderAll() {
      renderDashboard();
      renderDuties();
      renderPayments();
      renderDocuments();
      renderTrips();
      renderRegional();
      renderCalendar();
    }

    // DASHBOARD
    function renderDashboard() {
      const todayIso = new Date().toISOString().slice(0,10);
      const todayBox = document.getElementById('dashboard-today');
      const dutiesBox = document.getElementById('dashboard-duties');
      const payBox = document.getElementById('dashboard-payments');
      const tripBox = document.getElementById('dashboard-trip');

      todayBox.innerHTML = '';
      dutiesBox.innerHTML = '';
      payBox.innerHTML = '';
      tripBox.innerHTML = '';

      const todayEvents = events.filter(e => e.date === todayIso).sort(byDateAsc);
      todayEvents.forEach(e => todayBox.appendChild(createItemElement(e)));

      const upcomingDuties = events.filter(e => ['law','check','service'].includes(e.type)).sort(byDateAsc).slice(0,3);
      upcomingDuties.forEach(e => dutiesBox.appendChild(createItemElement(e)));

      const upcomingPayments = events.filter(e => e.type === 'payment').sort(byDateAsc).slice(0,3);
      upcomingPayments.forEach(e => payBox.appendChild(createItemElement(e)));

      const upcomingTrips = events.filter(e => e.type === 'trip').sort(byDateAsc).slice(0,1);
      upcomingTrips.forEach(e => tripBox.appendChild(createItemElement(e)));
    }

    // POVINNOSTI
    function renderDuties() {
      const lawBox = document.getElementById('duties-law');
      const checksBox = document.getElementById('duties-checks');
      const serviceBox = document.getElementById('duties-service');
      lawBox.innerHTML = '';
      checksBox.innerHTML = '';
      serviceBox.innerHTML = '';

      events.filter(e => e.type === 'law').sort(byDateAsc).forEach(e => lawBox.appendChild(createItemElement(e)));
      events.filter(e => e.type === 'check').sort(byDateAsc).forEach(e => checksBox.appendChild(createItemElement(e)));
      events.filter(e => e.type === 'service').sort(byDateAsc).forEach(e => serviceBox.appendChild(createItemElement(e)));
    }

    // PLATBY
    function renderPayments() {
      const box = document.getElementById('payments-list');
      box.innerHTML = '';
      events.filter(e => e.type === 'payment').sort(byDateAsc).forEach(e => box.appendChild(createItemElement(e)));
    }

    // DOKLADY
    function renderDocuments() {
      const box = document.getElementById('documents-list');
      box.innerHTML = '';
      events.filter(e => e.type === 'document').sort(byDateAsc).forEach(e => box.appendChild(createItemElement(e)));
    }

    // CESTY
    function renderTrips() {
      const box = document.getElementById('trips-list');
      box.innerHTML = '';
      events.filter(e => e.type === 'trip').sort(byDateAsc).forEach(e => box.appendChild(createItemElement(e)));
    }

    // REGION√ÅLNE ‚Äì statick√© demo
    function renderRegional() {
      const offices = document.getElementById('regional-offices');
      const health = document.getElementById('regional-health');
      offices.innerHTML = '';
      health.innerHTML = '';

      const officeItems = [
        { title: 'Da≈àov√Ω √∫rad Zvolen', extra: 'N√°mestie SNP 1, Zvolen ‚Ä¢ Po‚ÄìPi 8:00‚Äì15:00', address: 'N√°mestie SNP 1, Zvolen' },
        { title: 'Mestsk√Ω √∫rad Zvolen', extra: 'N√°mestie slobody 22, Zvolen', address: 'N√°mestie slobody 22, Zvolen' }
      ];
      officeItems.forEach((o, idx) => {
        const div = document.createElement('div');
        div.className = 'item';
        div.onclick = () => openDetailRegional(o.title, o.extra, o.address);
        div.innerHTML = `
          <div class="item-main">
            <div class="item-title">${o.title}</div>
            <div class="item-sub">${o.extra}</div>
          </div>
          <button class="btn-secondary" onclick="event.stopPropagation(); navigateFromCurrent('${o.address}')">Navigova≈•</button>
        `;
        offices.appendChild(div);
      });

      const healthItems = [
        { title: 'Pohotovos≈• ‚Äì dospel√≠', extra: 'Nemocnica Zvolen ‚Ä¢ nonstop', address: 'Nemocnica Zvolen' },
        { title: 'Lek√°re≈à ‚Äì nonstop', extra: '≈†t√∫rova 5, Zvolen', address: '≈†t√∫rova 5, Zvolen' }
      ];
      healthItems.forEach((o, idx) => {
        const div = document.createElement('div');
        div.className = 'item';
        div.onclick = () => openDetailRegional(o.title, o.extra, o.address);
        div.innerHTML = `
          <div class="item-main">
            <div class="item-title">${o.title}</div>
            <div class="item-sub">${o.extra}</div>
          </div>
          <button class="btn-secondary" onclick="event.stopPropagation(); navigateFromCurrent('${o.address}')">Navigova≈•</button>
        `;
        health.appendChild(div);
      });
    }

    // KALEND√ÅR ‚Äì jednoduch√Ω mesiac
    function renderCalendar() {
      const grid = document.getElementById('calendar-grid');
      grid.innerHTML = '';
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();
      const firstDay = new Date(year, month, 1);
      const startWeekday = firstDay.getDay() === 0 ? 7 : firstDay.getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for (let i = 1; i < startWeekday; i++) {
        const empty = document.createElement('div');
        empty.className = 'day';
        grid.appendChild(empty);
      }

      for (let d = 1; d <= daysInMonth; d++) {
        const dateIso = new Date(year, month, d).toISOString().slice(0,10);
        const dayDiv = document.createElement('div');
        dayDiv.className = 'day';
        dayDiv.innerHTML = `<span class="date">${d}</span><div class="dot-row"></div>`;
        const dotRow = dayDiv.querySelector('.dot-row');
        const dayEvents = events.filter(e => e.date === dateIso);
        const types = new Set(dayEvents.map(e => e.type));
        if (types.has('shift')) dotRow.appendChild(createDot('shift'));
        if (types.has('law') || types.has('check') || types.has('service')) dotRow.appendChild(createDot('law'));
        if (types.has('trip')) dotRow.appendChild(createDot('trip'));
        if (types.has('document')) dotRow.appendChild(createDot('doc'));
        if (types.has('payment')) dotRow.appendChild(createDot('pay'));

        if (dayEvents.length > 0) {
          dayDiv.style.cursor = 'pointer';
          dayDiv.onclick = () => {
            // otvor√≠me detail prvej udalosti v dan√Ω de≈à (na testovanie)
            openDetail(dayEvents[0].id);
          };
        }

        grid.appendChild(dayDiv);
      }
    }

    function createDot(type) {
      const div = document.createElement('div');
      div.className = 'dot dot-' + (type === 'shift' ? 'shift' :
                                    type === 'law' ? 'law' :
                                    type === 'trip' ? 'trip' :
                                    type === 'doc' ? 'doc' : 'pay');
      return div;
    }

    // Vytvorenie item elementu
    function createItemElement(e) {
      const div = document.createElement('div');
      div.className = 'item' + (e.status === 'done' ? ' status-done' : '');
      div.onclick = () => openDetail(e.id);
      const pill = getPillForType(e);
      div.innerHTML = `
        <div class="item-main">
          <div class="item-title">${e.title}</div>
          <div class="item-sub">${formatDate(e.date)}${e.extra ? ' ‚Ä¢ ' + e.extra : ''}</div>
        </div>
        ${pill}
      `;
      return div;
    }

    function getPillForType(e) {
      let label = '';
      let cls = 'pill';
      if (e.type === 'shift') { label = 'Zmena'; }
      else if (e.type === 'law') { label = 'Legislat√≠va'; }
      else if (e.type === 'check') { label = 'Kontrola'; }
      else if (e.type === 'service') { label = 'Servis'; }
      else if (e.type === 'payment') { label = 'Platba'; }
      else if (e.type === 'document') { label = 'Doklad'; }
      else if (e.type === 'trip') { label = 'Cesta'; }

      if (e.status === 'done') cls += ' pill-ok';
      return `<span class="${cls}">${label}</span>`;
    }

    // DETAIL MODAL
    function openDetail(id) {
      const e = events.find(ev => ev.id === id);
      if (!e) return;
      currentDetailId = id;

      const titleEl = document.getElementById('detail-title');
      const infoEl = document.getElementById('detail-info');
      const markBtn = document.getElementById('mark-done-btn');
      const delBtn = document.getElementById('delete-btn');
      const payBtn = document.getElementById('pay-now-btn');
      const navBtn = document.getElementById('navigate-btn');

      titleEl.textContent = e.title;
      infoEl.textContent = `${formatDate(e.date)}${e.extra ? ' ‚Ä¢ ' + e.extra : ''}`;

      payBtn.style.display = e.type === 'payment' ? 'inline-block' : 'none';
      navBtn.style.display = e.type === 'trip' && e.address ? 'inline-block' : 'none';

      markBtn.onclick = () => {
        e.status = e.status === 'done' ? 'open' : 'done';
        closeDetailModal();
        renderAll();
      };
      delBtn.onclick = () => {
        const idx = events.findIndex(ev => ev.id === id);
        if (idx !== -1) events.splice(idx,1);
        closeDetailModal();
        renderAll();
      };
      payBtn.onclick = () => {
        alert('Simul√°cia priamej platby: ' + e.title + '\\nV re√°lnej appke by sa otvorila bankov√° appka alebo QR platba.');
      };
      navBtn.onclick = () => {
        navigateFromCurrent(e.address);
      };

      document.getElementById('detail-modal').classList.remove('hidden');
    }

    function closeDetailModal() {
      document.getElementById('detail-modal').classList.add('hidden');
      currentDetailId = null;
    }

    // DETAIL REGION√ÅLNYCH KONTAKTOV
    function openDetailRegional(title, extra, address) {
      const titleEl = document.getElementById('detail-title');
      const infoEl = document.getElementById('detail-info');
      const markBtn = document.getElementById('mark-done-btn');
      const delBtn = document.getElementById('delete-btn');
      const payBtn = document.getElementById('pay-now-btn');
      const navBtn = document.getElementById('navigate-btn');

      currentDetailId = null;
      titleEl.textContent = title;
      infoEl.textContent = extra;

      markBtn.style.display = 'none';
      delBtn.style.display = 'none';
      payBtn.style.display = 'none';
      navBtn.style.display = address ? 'inline-block' : 'none';
      navBtn.onclick = () => navigateFromCurrent(address);

      document.getElementById('detail-modal').classList.remove('hidden');
    }

    // ADD MODAL
    function openAddModal(context) {
      currentAddContext = context;
      document.getElementById('add-title').textContent =
        context === 'payment' ? 'Nov√° platba' :
        context === 'duty' ? 'Nov√° povinnos≈•' :
        context === 'document' ? 'Nov√Ω doklad' :
        context === 'trip' ? 'Nov√° cesta' :
        'Nov√° udalos≈•';

      document.getElementById('add-form').reset();
      document.getElementById('add-modal').classList.remove('hidden');
    }

    function closeAddModal() {
      document.getElementById('add-modal').classList.add('hidden');
      currentAddContext = null;
    }

    document.getElementById('add-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('add-name').value.trim();
      const date = document.getElementById('add-date').value;
      const extra = document.getElementById('add-extra').value.trim();
      const address = document.getElementById('add-address').value.trim();
      const typeSpecific = document.getElementById('add-type-specific').value;

      if (!name || !date) return;

      let type = 'event';
      if (currentAddContext === 'payment') type = 'payment';
      else if (currentAddContext === 'duty') type = 'law';
      else if (currentAddContext === 'document') type = 'document';
      else if (currentAddContext === 'trip') type = 'trip';
      else if (currentAddContext === 'event' && typeSpecific) type = typeSpecific;

      const newId = events.length ? Math.max(...events.map(ev => ev.id)) + 1 : 1;
      const obj = { id: newId, type, title: name, date, extra, status: 'open' };
      if (type === 'payment') obj.payment = true;
      if (type === 'trip' && address) obj.address = address;

      events.push(obj);
      closeAddModal();
      renderAll();
    });

    // PREP√çNANIE SEKCI√ç
    function setupTabs() {
      const sections = document.querySelectorAll('.section');
      const tabButtons = document.querySelectorAll('.tab-btn');
      const footButtons = document.querySelectorAll('.tab-btn-foot');

      function showSection(id) {
        sections.forEach(sec => sec.classList.toggle('active', sec.id === id));
        tabButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.target === id));
        footButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.target === id));
      }

      tabButtons.forEach(btn => btn.addEventListener('click', () => showSection(btn.dataset.target)));
      footButtons.forEach(btn => btn.addEventListener('click', () => showSection(btn.dataset.target)));
    }

    // GPS NAVIG√ÅCIA
    function navigateFromCurrent(address) {
      if (!address) return;
      if (!navigator.geolocation) {
        alert('GPS poloha nie je podporovan√° v tomto prehliadaƒçi.');
        const url = 'https://mapy.cz/zakladni?q=' + encodeURIComponent(address);
        window.open(url, '_blank');
        return;
      }
      navigator.geolocation.getCurrentPosition(
        pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const url = `https://mapy.cz/zakladni?planovani-trasy&rc=${lat},${lon}|${encodeURIComponent(address)}`;
          window.open(url, '_blank');
        },
        err => {
          alert('Nepodarilo sa z√≠ska≈• GPS polohu. Otv√°ram Mapy.cz len s cieƒæom.');
          const url = 'https://mapy.cz/zakladni?q=' + encodeURIComponent(address);
          window.open(url, '_blank');
        }
      );
    }

    // INIT
    seedData();
    setupTabs();
    renderAll();
  </script>
</body>
</html>







  




  






  






  




  



  




  

  



  


  
